(this["webpackJsonpmutual-aid-networks"]=this["webpackJsonpmutual-aid-networks"]||[]).push([[0],{233:function(e,t,n){e.exports=n(420)},313:function(e,t,n){},314:function(e,t,n){},315:function(e,t,n){},316:function(e,t,n){},318:function(e,t,n){},335:function(e,t,n){},370:function(e,t,n){},393:function(e,t,n){},412:function(e,t,n){},419:function(e,t,n){},420:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"requestNetworks",(function(){return P})),n.d(r,"setPageOfNetworks",(function(){return x}));var a={};n.r(a),n.d(a,"getSelectedCategories",(function(){return A})),n.d(a,"getSearchLocation",(function(){return R})),n.d(a,"getHoveredPointId",(function(){return _})),n.d(a,"getViewState",(function(){return H}));var o={};n.r(o),n.d(o,"getAllNetworks",(function(){return V})),n.d(o,"getFilteredNetworks",(function(){return W})),n.d(o,"getNetworksInArea",(function(){return z})),n.d(o,"getVisibleCards",(function(){return D})),n.d(o,"getBoundingBox",(function(){return G}));var s={};n.r(s),n.d(s,"setCategoryFilters",(function(){return $})),n.d(s,"setLatLng",(function(){return ee})),n.d(s,"setHoveredPoint",(function(){return te}));var i=n(26),l=n(27),c=n(36),u=n(32),d=n(35),p=n(0),m=n.n(p),f=n(132),b=n(6),h=n.n(b);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(242);var g=n(37),v=n(87),k=n(431),w=n(209),y=n.n(w),E=n(53),O=function(e,t){return"".concat(e,"-").concat(t)},N=O("EVENTS","REQUEST_NETWORKS"),C=O("EVENTS","SET_NETWORKS"),j=O("EVENTS","REQUEST_FAILED"),L=O("EVENTS","SET_PAGE_OF_NETWORKS"),S={allNetworks:[]},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case C:return Object(E.a)({},e,{allNetworks:r,error:null});case L:return Object(E.a)({},e,{allNetworks:[].concat(Object(g.a)(e.allNetworks),Object(g.a)(r)),error:null});case j:return console.log("REQUEST_FAILED: ".concat(r)),Object(E.a)({},e,{error:r});default:return e}},P=function(){return{type:N}},x=function(e){return{type:L,payload:e}},I=n(68),T=n(24),B=n(168),q=n(433),A=function(e){return e.selections.categories},R=function(e){return e.selections.searchLocation},_=function(e){return e.selections.hoveredPointId},H=Object(I.a)([R],(function(e){return e.lat?"list":"default"})),M=window.mapboxgl,V=function(e){return e.networks.allNetworks},W=Object(I.a)([V,A],(function(e,t){return t.length?Object(T.filter)(e,(function(e){return t.includes(e.category)})):[]})),z=Object(I.a)([V,R],(function(e,t){if(!t.lat)return[];var n=new B.b(Number(t.lat),Number(t.lng));return e.filter((function(e){return Object(q.a)(n,new B.b(Number(e.lat),Number(e.lng)))<80467})).sort((function(e,t){return Object(q.a)(n,new B.b(Number(e.lat),Number(e.lng)))-Object(q.a)(n,new B.b(Number(t.lat),Number(t.lng)))}))})),D=Object(I.a)([W,R],(function(e,t){if(!t.lat)return[];var n=new B.b(Number(t.lat),Number(t.lng));return e.filter((function(e){return Object(q.a)(n,new B.b(Number(e.lat),Number(e.lng)))<80467})).sort((function(e,t){return Object(q.a)(n,new B.b(Number(e.lat),Number(e.lng)))-Object(q.a)(n,new B.b(Number(t.lat),Number(t.lng)))}))})),G=Object(I.a)([z],(function(e){return e.length?e.reduce((function(e,t,n){return n>0&&(e=e.extend(t)),e}),new M.LngLatBounds(e[0].bbox)):null})),U=n(430),Z={actions:r,logics:[Object(U.a)({type:N,process:function(e,t,n){var r=e.httpClient,a=e.firebaseUrl;!function e(o){return r.get(o).then((function(r){var o=function(e){return e.body.documents.map((function(e){var t=e.fields;return Object(T.mapValues)(t,(function(e){var t=Object(T.values)(e)[0];return e.integerValue&&(t=Number(t)),t.values&&(t=Object(T.map)(t.values,(function(e){return Object(T.values)(e)[0]}))),t}))}))}(r);if(t(x(o)),r.body.nextPageToken){var s="".concat(a,"/?pageToken=").concat(r.body.nextPageToken);return e(s)}n()}))}(a)}})],reducers:F,selectors:o},Q=O("SELECTIONS","FILTER_BY_CATEGORY"),K=O("SELECTIONS","SET_LAT_LNG"),Y=O("SELECTIONS","SET_HOVERED_POINT"),J=["General","Request Support","Offer Support","Community"],X={view:"default",categories:J,language:"",community:"",searchLocation:{},hoveredPointId:null},$=function(e){return{type:Q,payload:e}},ee=function(e){return{type:K,payload:e}},te=function(e){return{type:Y,payload:e}},ne={actions:s,logics:[],reducers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Q:return Object(E.a)({},e,{categories:t.payload});case K:return Object(E.a)({},e,{searchLocation:t.payload});case Y:return Object(E.a)({},e,{hoveredPointId:t.payload});default:return e}},selectors:a},re={networks:Z.reducers,selections:ne.reducers},ae=[].concat(Object(g.a)(Z.logics),Object(g.a)(ne.logics)),oe={firebaseUrl:"https://firestore.googleapis.com/v1/projects/townhallproject-86312/databases/(default)/documents/mutual_aid_networks",httpClient:y.a},se=Object(k.a)(ae,oe),ie=Object(v.a)(se);n(279);var le=n(227),ce=(n(282),n(108)),ue=n(28),de=n(210),pe=n.n(de),me=n(2),fe=n.n(me),be="networks-dots",he="pk.eyJ1IjoidG93bmhhbGxwcm9qZWN0IiwiYSI6ImNrN3d1c3hhdDA1MmozbW80cW5oOWxzcHoifQ.rq66iVpULeHVB6PutWiunA",ge="mapbox://styles/townhallproject/ck87rw1kt1g821is46uvwm08k",ve=window.mapboxgl,ke=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).addClickListener=n.addClickListener.bind(Object(ue.a)(n)),n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.initializeMap()}},{key:"setFilters",value:function(){var e=this.props.selectedCategories;if(this.map.getLayer(be)){var t=["any"].concat(Object(g.a)(e.map((function(e){return["==",["get","category"],e]}))));this.map.setFilter(be,t)}}},{key:"componentDidUpdate",value:function(e){var t=this.props.selectedCategories;Object(T.isEqual)(t,e.selectedCategories)||this.setFilters()}},{key:"addClickListener",value:function(){var e=this.props,t=e.bounds,n=e.setBounds;this.map.on("click",(function(){n(t)}))}},{key:"initializeMap",value:function(){var e=this,t=this.props,n=t.bounds,r=t.mapId;ve.accessToken=he,this.map=new ve.Map({container:r,doubleClickZoom:!1,dragPan:!1,scrollZoom:!1,style:ge}),this.map.fitBounds(n,{easeTo:{duration:0},linear:!0}),this.map.on("load",(function(){e.addClickListener()}))}},{key:"render",value:function(){var e=this.props,t=e.viewState,n=e.mapId,r=fe()({hidden:"list"===t,inset:!0});return m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{id:n,className:r,"data-bounds":this.props.bounds}))}}]),t}(m.a.Component);ke.defaultProps={selectedState:""};var we=ke,ye=(n(313),n(314),n(315),n(316),window.mapboxgl),Ee=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).filterDistrict=["any"],n.includedStates=["in","NAME"],n.addPopups=n.addPopups.bind(Object(ue.a)(n)),n.addClickListener=n.addClickListener.bind(Object(ue.a)(n)),n.setFilters=n.setFilters.bind(Object(ue.a)(n)),n.handleReset=n.handleReset.bind(Object(ue.a)(n)),n.insetOnClickEvent=n.insetOnClickEvent.bind(Object(ue.a)(n)),n.handleClickOnInset=n.handleClickOnInset.bind(Object(ue.a)(n)),n.initializeMap=n.initializeMap.bind(Object(ue.a)(n)),n.state={popoverColor:"popover-general-icon",bbox:null},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.initializeMap()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.hoveredPointId,r=t.viewState,a=t.bbox,o=t.selectedCategories;this.map.resize(),Object(T.isEqual)(o,e.selectedCategories)||this.setFilters(),e.viewState!==r&&(this.hoveredPopup.remove(),"default"===r&&this.setInitialState()),this.state.bbox&&"list"===r&&(this.fitBounds(this.state.bbox),this.setState({bbox:null})),a&&"list"===r&&a!==e.bbox&&this.fitBounds(a),n&&this.hoverPoint(n),e.hoveredPointId&&e.hoveredPointId!==n&&this.unHoverPoint(e.hoveredPointId)}},{key:"insetOnClickEvent",value:function(e){this.setState({inset:!1});var t=e.target.parentNode.parentNode.getAttribute("data-bounds").split(","),n=[Number(t[0]),Number(t[1])],r=[Number(t[2]),Number(t[3])],a=n.concat(r);this.fitBounds(a)}},{key:"fitBounds",value:function(e){this.map.fitBounds(e,{padding:{top:10,bottom:25,left:15,right:5},maxZoom:8})}},{key:"addPopups",value:function(e){var t=this,n=this.map;this.hoveredPopup=new ye.Popup({closeButton:!0,closeOnClick:!0}),n.on("mousemove",(function(r){if(t.map.getLayer(be)){var a=n.queryRenderedFeatures(r.point,{layers:[e]});if(n.getCanvas().style.cursor=a.length?"pointer":"",a.length){var o,s=a[0],i=s.properties,l="popover-".concat(s.properties.category.split(" ").join("-").toLowerCase());return t.setState({popoverColor:l}),t.props.setHoveredPoint(s.id),o=i.generalForm?'<a rel="noopener noreferrer" target="_blank" href='.concat(i.generalForm,">Link to form</a>"):i.supportOfferForm&&i.supportRequestForm?'<a rel="noopener noreferrer" class="side-by-side" target="_blank" href='.concat(i.supportOfferForm,'>Offer support</a><a class="side-by-side" target="_blank" href=').concat(i.supportRequestForm,">Request support</a>"):i.supportOfferForm?'<a rel="noopener noreferrer" href='.concat(i.supportOfferForm,">Offer support</a>"):i.supportRequestForm?'<a rel="noopener noreferrer" href='.concat(i.supportRequestForm,">Request support</a>"):'<a rel="noopener noreferrer" href='.concat(i.facebookPage,">Link to group</a>"),t.hoveredPopup.setLngLat(s.geometry.coordinates).setHTML("\n            <h4>".concat(i.title,"</h4>\n            <div>").concat(i.city,", ").concat(i.state,"</div>\n            <div>").concat(o,"</div>")).addTo(n)}}}))}},{key:"addClickListener",value:function(){var e=this.map,t=this.props.setLatLng;e.getLayer(be)&&e.on("click",(function(n){var r=e.queryRenderedFeatures(n.point,{layers:[be]});r.length>0&&t({lat:r[0].properties.lat,lng:r[0].properties.lng})}))}},{key:"hoverPoint",value:function(e){this.map.getLayer(be)&&this.map.setFeatureState({source:"composite",sourceLayer:"ma-networks-dataset",id:e},{hover:!0})}},{key:"unHoverPoint",value:function(e){this.map.getLayer(be)&&this.map.setFeatureState({source:"composite",sourceLayer:"ma-networks-dataset",id:e},{hover:!1})}},{key:"handleReset",value:function(){(0,this.props.setLatLng)({})}},{key:"setInitialState",value:function(){this.fitBounds([[-128.8,23.6],[-65.4,50.2]]),document.getElementsByClassName("mapboxgl-ctrl-geocoder--input"),Array.from(document.getElementsByClassName("mapboxgl-ctrl-geocoder--input")).forEach((function(e){e.value=""})),this.map.resize()}},{key:"handleClickOnInset",value:function(e){this.setState({bbox:e});var t=new ye.LngLatBounds(e).getCenter();this.props.setLatLng(t)}},{key:"makeZoomToNationalButton",value:function(){document.querySelector(".mapboxgl-ctrl-compass").remove(),document.querySelector(".mapboxgl-ctrl-usa")&&document.querySelector(".mapboxgl-ctrl-usa").remove();var e=document.createElement("button");e.className="mapboxgl-ctrl-icon mapboxgl-ctrl-usa",e.innerHTML='<span class="usa-icon"></span>',e.addEventListener("click",this.handleReset),document.querySelector(".mapboxgl-ctrl-group").appendChild(e)}},{key:"setFilters",value:function(){var e=this.props.selectedCategories,t=this.map.getLayer(be);if(console.log(t),t){console.log("setting filter");var n=["any"].concat(Object(g.a)(e.map((function(e){return["==",["get","category"],e]}))));this.map.setFilter(be,n)}}},{key:"initializeMap",value:function(){var e=this,t=this.props.setLatLng;ye.accessToken=he,this.map=new ye.Map({container:"map",style:ge}),this.map.addControl(new ye.NavigationControl),this.map.scrollZoom.disable(),this.map.dragRotate.disable(),this.map.touchZoomRotate.disableRotation(),this.makeZoomToNationalButton();var n=this.map;this.map.addControl(new pe.a({accessToken:ye.accessToken,mapboxgl:ye,countries:"us",marker:!1,zoom:12,flyTo:!1}).on("clear",(function(e){t({})})).on("result",(function(e){n.resize(),t({lat:e.result.center[1],lng:e.result.center[0]})})),"top-left"),this.fitBounds([[-128.8,23.6],[-65.4,50.2]]),this.map.on("load",(function(){e.addClickListener(),e.addPopups(be)}))}},{key:"render",value:function(){var e=this.props,t=e.center,n=e.resetSelections,r=e.setLatLng,a=e.viewState,o=e.networks,s=e.selectedCategories;return m.a.createElement(m.a.Fragment,null,m.a.createElement("div",{id:"map",className:this.state.popoverColor},m.a.createElement("div",{className:"map-overlay",id:"legend"},m.a.createElement(we,{networks:Object(T.filter)(o,{state:"AK"}),center:t,stateName:"AK",viewState:a,resetSelections:n,selectedCategories:s,setLatLng:r,setBounds:this.handleClickOnInset,mapId:"map-overlay-alaska",bounds:[[-170.15625,51.72702815704774],[-127.61718749999999,71.85622888185527]]}),m.a.createElement(we,{networks:Object(T.filter)(o,{state:"HI"}),stateName:"HI",center:t,viewState:a,resetSelections:n,selectedCategories:s,setLatLng:r,setBounds:this.handleClickOnInset,mapId:"map-overlay-hawaii",bounds:[[-161.03759765625,18.542116654448996],[-154.22607421875,22.573438264572406]]}))))}}]),t}(m.a.Component);Ee.defaultProps={};var Oe=Ee,Ne=(n(187),n(230)),Ce=(n(318),function(){return m.a.createElement("div",{className:"start-network-container"},m.a.createElement(Ne.a,{id:"start-network-button",target:"_blank",href:"https://docs.google.com/forms/d/e/1FAIpQLScuqQtCdKsDzvTzaA2PMyVHX7xcOqbOW7N7l_0YJASV4wMBVQ/viewform"},"Submit a Mutual Aid Network"))}),je=(n(333),n(138)),Le=(n(335),je.a.Group),Se=function(e){function t(){var e,n;Object(i.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(a)))).state={indeterminate:!1,checkAll:!0},n.onChange=function(e){n.props.setFilters(e),n.setState({indeterminate:!!e.length&&e.length<J.length,checkAll:e.length===J.length})},n.onCheckAllChange=function(e){var t=e.target.checked?J:[];n.setState({indeterminate:!1,checkAll:e.target.checked}),n.props.setFilters(t)},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.props.visible?m.a.createElement("div",{className:fe()("filter-container",{"absolute-pos":this.props.absolute})},m.a.createElement("div",{className:"site-checkbox-all-wrapper"},m.a.createElement(je.a,{indeterminate:this.state.indeterminate,onChange:this.onCheckAllChange,checked:this.state.checkAll},"Select all")),m.a.createElement("br",null),m.a.createElement(Le,{value:this.props.selectedCategories,onChange:this.onChange},J.map((function(e){return m.a.createElement(je.a,{key:e.replace(" ","-").toLowerCase(),className:e.replace(" ","-").toLowerCase(),value:e},e)})))):null}}]),t}(m.a.Component),Fe=(n(422),n(229)),Pe=n(432),xe=(n(421),n(228)),Ie=(n(201),n(55)),Te=(n(370),function(e){return m.a.createElement(m.a.Fragment,null,e.networks.map((function(t){var n=t.address,r=t.title,a=t.neighborhood,o=t.facebookPage,s=t.category,i=t.community,l=t.language,c=t.generalForm,u=t.supportRequestForm,d=t.supportOfferForm,p=t.id;return m.a.createElement(xe.a,{className:"network-card",title:r,key:p,onMouseEnter:function(){return e.setHoveredPoint(p)},onMouseLeave:function(){return e.setHoveredPoint(null)},extra:m.a.createElement("ul",{className:"list-inline"},s&&m.a.createElement("li",{className:"text-".concat(s.split(" ").join("-").toLowerCase())},s),i&&m.a.createElement("li",null,i))},m.a.createElement("ul",{className:"list-inline"},a&&m.a.createElement("li",null,a),n&&m.a.createElement("li",null,n),l&&m.a.createElement("li",null,l)),m.a.createElement(Ie.a,{justify:"space-between"},c&&m.a.createElement("a",{href:c,target:"_blank",rel:"noopener noreferrer",className:"button"},"Offer or request help"),u&&m.a.createElement("a",{href:u,rel:"noopener noreferrer",target:"_blank",className:"button"},"Request help"),d&&m.a.createElement("a",{href:d,rel:"noopener noreferrer",target:"_blank",className:"button"},"Offer help"),o&&m.a.createElement("a",{href:o,rel:"noopener noreferrer",target:"_blank",className:"button"},"Join social media")))})))}),Be=(n(393),Fe.a.Title),qe=function(){return m.a.createElement("div",{className:"no-network-section"},m.a.createElement(Be,{level:3},m.a.createElement(Pe.a,null)),m.a.createElement(Be,{level:3},"There are no support requests or networks nearby."))},Ae=function(e){var t=e.visibleCards,n=e.setHoveredPoint,r=e.setFilters,a=e.selectedCategories;return m.a.createElement("div",{className:"list-container"},t.length?m.a.createElement(m.a.Fragment,null,m.a.createElement(Se,{setFilters:r,absolute:!1,selectedCategories:a,visible:!0}),m.a.createElement(Te,{setHoveredPoint:n,networks:t})):m.a.createElement(qe,null))},Re=(n(412),function(){return m.a.createElement("div",{class:"webGl-warning",target:"_blank"},m.a.createElement("p",null,"Our interactive map feature uses WebGL, a plugin common in most modern browsers. Your browser does not have WebGL working currently."),m.a.createElement("p",null,"You can learn how to enable WebGL on",m.a.createElement("a",{rel:"noopener noreferrer",href:"https://get.webgl.org/",target:"_blank"}," this website.")))}),_e=ce.a.Header,He=ce.a.Content,Me=ce.a.Footer,Ve=window.mapboxgl,We=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.requestNetworks)()}},{key:"render",value:function(){var e=this.props,t=e.setFilters,n=e.selectedCategories,r=e.filteredNetworks,a=e.viewState,o=e.setLatLng,s=e.visibleCards,i=e.allNetworks,l=e.setHoveredPoint,c=e.hoveredPointId,u=e.masterBbox;return i.length?m.a.createElement(ce.a,{className:"layout"},m.a.createElement(_e,null,m.a.createElement("div",{className:"logo"}),m.a.createElement(le.a,{theme:"dark",mode:"horizontal",style:{lineHeight:"64px"}})),m.a.createElement(He,{style:{padding:"0 50px"}},m.a.createElement("div",{className:"main-container"},Ve.supported()?m.a.createElement(m.a.Fragment,null,m.a.createElement(Se,{setFilters:t,selectedCategories:n,absolute:!0,visible:"default"===a}),m.a.createElement("div",{className:"interactive-content-".concat(a)},m.a.createElement(Oe,{networks:r,viewState:a,setLatLng:o,selectedCategories:n,hoveredPointId:c,setHoveredPoint:l,bbox:u}),m.a.createElement(Ae,{visibleCards:s,setHoveredPoint:l,setFilters:t,selectedCategories:n}))):m.a.createElement(Re,null),m.a.createElement("div",{className:"tagline"},"Find Mutual Aid Networks and other community self-support projects near you. Reach out to these groups directly via the map above to get involved, offer resources, or submit needs requests."),m.a.createElement(Ce,null))),m.a.createElement(Me,{style:{textAlign:"center"}},m.a.createElement("div",{className:"footer-text"},"We list these networks as a public resource. We cannot verify or vouch for any network or individual offerings. Please exercise all necessary judgement when interacting with community members not previously known to you."))):null}}]),t}(m.a.Component),ze=Object(f.b)((function(e){return{filteredNetworks:Z.selectors.getFilteredNetworks(e),selectedCategories:ne.selectors.getSelectedCategories(e),viewState:ne.selectors.getViewState(e),searchLocation:ne.selectors.getSearchLocation(e),visibleCards:Z.selectors.getVisibleCards(e),allNetworks:Z.selectors.getAllNetworks(e),hoveredPointId:ne.selectors.getHoveredPointId(e),masterBbox:Z.selectors.getBoundingBox(e)}}),(function(e){return{requestNetworks:function(){return e(Z.actions.requestNetworks())},setFilters:function(t){return e(ne.actions.setCategoryFilters(t))},setLatLng:function(t){return e(ne.actions.setLatLng(t))},setHoveredPoint:function(t){return e(ne.actions.setHoveredPoint(t))}}}))(We),De=(n(419),Object(v.d)(Object(v.c)(re),ie)),Ge=function(e){function t(){return Object(i.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return m.a.createElement(f.a,{store:De},m.a.createElement(ze,null))}}]),t}(p.Component);h.a.render(m.a.createElement(Ge,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[233,1,2]]]);
//# sourceMappingURL=main.b8f4bfcb.chunk.js.map